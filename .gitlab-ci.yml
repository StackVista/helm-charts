image: alpine:latest

stages:
  - test

before_script:
  # APK
  - apk add --no-cache bash curl openssl
  # Helm
  - curl -fSL https://git.io/get_helm.sh | bash -
  - helm init --client-only
  - helm plugin install https://github.com/chartmuseum/helm-push
  - helm plugin install https://github.com/lrills/helm-unittest

helm-lint-charts:
  image: gcr.io/kubernetes-charts-ci/test-image:v3.3.2
  stage: test
  script:
    - git remote add stackstate-helm https://oauth2:$GITLAB_ACCESS_TOKEN@gitlab.com/stackvista/devops/helm-charts
    - git fetch stackstate-helm
    - ct lint --config test/ct.yaml
  tags:
    - k8s-medium
